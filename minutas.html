<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <link href="favicon.ico" rel="icon" type="image/x-icon"/>
  <link href="apple-touch-icon.png" rel="apple-touch-icon"/>
  <meta content="yes" name="apple-mobile-web-app-capable"/>
  <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
  <meta content="#1f334d" name="theme-color"/>
  <meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" name="viewport"/>
  <title>Biblioteca Jurídica – ANF</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" rel="stylesheet"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <style>
    :root { 
      --primary:#1f334d;
      --bg:#f5f7fa;
      --text:#333;
      --card-bg:#fff;
      --radius:12px;
      --shadow:0 2px 10px rgba(0,0,0,0.08); 
    }
    * { box-sizing:border-box; margin:0; padding:0; }
    body {
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Ubuntu,sans-serif;
      background:var(--bg);
      color:var(--text);
      display:flex;
      flex-direction:column;
      height:100vh;
      overflow:hidden;
    }
    header {
      background:var(--primary);
      color:#fff;
      padding:1rem;
      display:flex;
      flex-direction:column;
      z-index:100;
    }
    header .title-bar { display:flex; align-items:center; }
    header h1 {
      font-size:1.4rem;
      margin:0;
      flex:1;
    }
    header .home-btn {
      color:#fff;
      background:rgba(255,255,255,0.2);
      border:none;
      border-radius:var(--radius);
      padding:0.4rem 0.8rem;
      display:flex;
      align-items:center;
      gap:0.5rem;
      cursor:pointer;
      font-size:0.9rem;
    }
    header .home-btn:hover { background:rgba(255,255,255,0.3); }
    /* Header compacto para modo standalone */
    header.compact {
      padding:0.3rem 0.5rem;
    }
    header.compact h1 { font-size:1.1rem; }
    .toolbar { display:flex; align-items:center; justify-content:space-between;
      background:#e8ebf0;
      padding:0.75rem;
      border-bottom:1px solid rgba(0,0,0,0.1);
    }
    .toolbar.compact { padding:0.25rem 0.75rem; }
    .view-btns button {
      background:rgba(255,255,255,0.8);
      border:none;
      border-radius:50%;
      width:36px;
      height:36px;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:var(--shadow);
      color:var(--primary);
      margin-right:0.5rem;
      cursor:pointer;
    }
    .view-btns button.active { background:var(--primary); color:#fff; }
    .toolbar.compact .view-btns button { width:30px; height:30px; font-size:0.85rem; }
    select.cat-filter {
      flex:1;
      padding:0.5rem 1rem;
      border:1px solid #ccc;
      border-radius:var(--radius);
      font-size:0.95rem;
      margin-right:1rem;
      box-shadow:var(--shadow);
    }
    main { flex:1; overflow-y:auto; padding:0.75rem; position:relative; }
    main.doc-mode { padding-top:0; }
    .doc-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:0.75rem; }
    .doc-list { display:flex; flex-direction:column; gap:0.5rem; }
    .doc-item {
      background:var(--card-bg);
      border-radius:var(--radius);
      padding:1.25rem 0.75rem;
      display:flex;
      flex-direction:column;
      align-items:center;
      box-shadow:var(--shadow);
      border-top:4px solid var(--primary);
      cursor:pointer;
      transition:transform 0.2s, box-shadow 0.2s;
    }
    .doc-item:hover { transform:translateY(-3px); box-shadow:0 4px 15px rgba(0,0,0,0.1); }
    .doc-icon { font-size:2rem; color:var(--primary); margin-bottom:0.75rem; }
    .doc-title { font-weight:600; text-align:center; font-size:0.9rem; line-height:1.3; }
    .doc-category { font-size:0.8rem; color:#666; margin-top:0.5rem; text-align:center; }
    #minutas-viewer {
      display:none;
      background:#fff;
      padding:1rem;
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow-y:auto;
      height:100%;
    }
    .back-btn {
      position:absolute;
      top:1rem;
      right:1rem;
      background:var(--primary);
      color:#fff;
      border:none;
      border-radius:50%;
      width:40px;
      height:40px;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:var(--shadow);
      cursor:pointer;
      z-index:10;
    }
    .back-btn:hover { background:#2a4360; }
    .loading-overlay {
      position:absolute;
      top:0; left:0; right:0; bottom:0;
      background:rgba(255,255,255,0.8);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      z-index:100;
      display:none;
    }
    .loading-spinner {
      border:4px solid rgba(0,0,0,0.1);
      border-left:4px solid var(--primary);
      border-radius:50%;
      width:40px;
      height:40px;
      animation:spin 1s linear infinite;
      margin-bottom:1rem;
    }
    .error-message {
      background:#fff;
      border-left:4px solid #ff4136;
      padding:1rem;
      border-radius:var(--radius);
      margin:1rem 0;
      display:none;
    }
    .no-results { text-align:center; padding:2rem; font-size:1.1rem; color:#666; }
    @keyframes spin { 0% {transform:rotate(0deg);} 100% {transform:rotate(360deg);} }
    body.standalone header { padding-top:env(safe-area-inset-top); }
    body.standalone .toolbar { margin-top:0; }
    body.standalone { padding-bottom:env(safe-area-inset-bottom); }
    @media (prefers-color-scheme: dark) {
      :root { --bg:#121212; --text:#eee; --card-bg:#1e1e1e; }
      .toolbar { background:#222; border-bottom:1px solid rgba(255,255,255,0.1); }
      #minutas-viewer { background:#1e1e1e; color:#eee; }
      .loading-overlay { background:rgba(0,0,0,0.7); color:white; }
      .error-message { background:#1e1e1e; color:#eee; }
    }
    @media screen and (max-width: 480px) {
      #minutas-viewer { padding:0.5rem; font-size:0.95rem; }
      .toolbar.compact .view-btns button { width:28px; height:28px; }
    }

    /* Ajustes solicitados */
    header h1 { font-size:1.2rem; }
    @media screen and (max-width:480px) { header h1 { font-size:1rem; } }
    select.cat-filter {
      background:#ffffff;
      color:var(--primary);
      font-weight:600;
      font-size:0.9rem;
      border:2px solid var(--primary);
      box-shadow:none;
    }
    #minutas-viewer {
      white-space:pre-line;
      line-height:1.6;
      padding:1rem;
    }
    #minutas-viewer h1,
    #minutas-viewer h2,
    #minutas-viewer h3,
    #minutas-viewer h4 {
      margin-top:1.5rem;
      margin-bottom:0.75rem;
    }
    #minutas-viewer p { margin-bottom:1rem; }
  </style>
</head>
<body>
  <header id="main-header">
    <div class="title-bar">
      <h1>Minutas de Jurisprudencia</h1>
      <button id="home-btn" class="home-btn"><i class="fa-solid fa-house"></i> Inicio</button>
    </div>
  </header>
  <div class="toolbar" id="main-toolbar">
    <select id="minutas-catFilter" class="cat-filter">
      <option value="all">Todas las categorías</option>
      <option value="Control de Identidad">Control de Identidad</option>
      <option value="Detención y Aprehensión">Detención y Aprehensión</option>
      <option value="Diligencias e Investigación">Diligencias e Investigación</option>
      <option value="Evidencia y Cadena de Custodia">Evidencia y Cadena de Custodia</option>
      <option value="Procedimiento y Garantías">Procedimiento y Garantías</option>
      <option value="Delitos y Tipicidad">Delitos y Tipicidad</option>
    </select>
    <div class="view-btns">
      <button id="minutas-grid-btn" class="active" title="Vista en cuadrícula"><i class="fa-solid fa-table-cells"></i></button>
      <button id="minutas-list-btn" title="Vista en lista"><i class="fa-solid fa-list"></i></button>
    </div>
  </div>
  <main id="main-container">
    <div id="minutas-docList" class="doc-grid"></div>
    <div id="minutas-viewer"></div>
    <button id="back-btn" class="back-btn" style="display:none;"><i class="fa-solid fa-arrow-left"></i></button>
    <div class="loading-overlay" id="loading-overlay">
      <div class="loading-spinner"></div>
      <p>Cargando documento...</p>
    </div>
    <div class="error-message" id="error-message">
      <h3>Error al cargar el documento</h3>
      <p>No se ha podido cargar el documento solicitado. Por favor, intente nuevamente más tarde.</p>
    </div>
  </main>
  <script>
  (function(){
    function checkStandalone() {
      if (window.matchMedia('(display-mode: standalone)').matches || 
          window.navigator.standalone === true) {
        document.body.classList.add('standalone');
        document.getElementById('main-header').classList.add('compact');
        document.getElementById('main-toolbar').classList.add('compact');
      }
    }
    checkStandalone();
    window.matchMedia('(display-mode: standalone)').addEventListener('change', checkStandalone);

    let docs = [];
    const docListEl = document.getElementById('minutas-docList');
    const viewerEl = document.getElementById('minutas-viewer');
    const gridBtn = document.getElementById('minutas-grid-btn');
    const listBtn = document.getElementById('minutas-list-btn');
    const filterEl = document.getElementById('minutas-catFilter');
    const backBtn = document.getElementById('back-btn');
    const homeBtn = document.getElementById('home-btn');
    const loadingOverlay = document.getElementById('loading-overlay');
    const errorMessage = document.getElementById('error-message');
    const mainContainer = document.getElementById('main-container');

    let currentDocument = null;
    let appState = 'home';

    async function fetchDocumentList() {
      docs = [ /* ... lista de minutas ... */ ];
    }

    function renderDocuments() {
      docListEl.innerHTML = '';
      const selectedCategory = filterEl.value;
      fetchDocumentList();
      const filteredDocs = selectedCategory === 'all' ? docs : docs.filter(doc => doc.category === selectedCategory);
      if (!filteredDocs.length) {
        docListEl.innerHTML = '<div class="no-results">No se encontraron documentos en esta categoría.</div>';
        return;
      }
      filteredDocs.forEach(doc => {
        const card = document.createElement('div');
        card.className = 'doc-item';
        card.innerHTML = `<div class="doc-icon"><i class="fa-solid fa-file-lines"></i></div>
                          <div class="doc-title">${doc.title}</div>
                          <div class="doc-category">${doc.category}</div>`;
        card.addEventListener('click', () => openDocument(doc));
        docListEl.appendChild(card);
      });
      applyViewMode();
    }

    function applyViewMode() {
      docListEl.className = gridBtn.classList.contains('active') ? 'doc-grid' : 'doc-list';
    }

    async function openDocument(doc) {
      try {
        appState = 'viewer';
        currentDocument = doc;
        docListEl.style.display = 'none';
        viewerEl.style.display = 'block';
        backBtn.style.display = 'flex';
        loadingOverlay.style.display = 'flex';
        errorMessage.style.display = 'none';
        mainContainer.classList.add('doc-mode');
        const response = await fetch(encodeURI(doc.path));
        if (!response.ok) throw new Error(`${response.status} ${response.statusText}`);
        const markdownText = await response.text();
        const htmlContent = marked.parse(markdownText);
        viewerEl.innerHTML = `<h1>${doc.title}</h1>${htmlContent}`;
        viewerEl.dataset.original = viewerEl.innerHTML;
        if (window.hljs) window.hljs.highlightAll();
      } catch (error) {
        console.error('Error al cargar el documento:', error);
        errorMessage.style.display = 'block';
      } finally {
        loadingOverlay.style.display = 'none';
      }
    }

    function goToHome() {
      appState = 'home';
      currentDocument = null;
      docListEl.style.display = 'grid';
      viewerEl.style.display = 'none';
      backBtn.style.display = 'none';
      errorMessage.style.display = 'none';
      mainContainer.classList.remove('doc-mode');
      applyViewMode();
    }

    function setupEventListeners() {
      backBtn.addEventListener('click', goToHome);
      homeBtn.addEventListener('click', () => window.location.href = 'index.html');
      gridBtn.addEventListener('click', () => { gridBtn.classList.add('active'); listBtn.classList.remove('active'); applyViewMode(); });
      listBtn.addEventListener('click', () => { listBtn.classList.add('active'); gridBtn.classList.remove('active'); applyViewMode(); });
      filterEl.addEventListener('change', renderDocuments);
      document.addEventListener('keydown', e => { if (e.key === 'Escape' && appState === 'viewer') goToHome(); });
    }

    function init() {
      setupEventListeners();
      renderDocuments();
    }
    if (document.readyState === 'loading') doc.addEventListener('DOMContentLoaded', init);
    else init();
  })();
  </script>
</body>
</html>
